{"version":3,"file":"lib.79ddc81f.js","mappings":"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","sources":["webpack:///../src/entity/utils.ts","webpack:///../src/entity/index.ts","webpack:///../src/svgIcon.ts","webpack:///../src/dom.ts","webpack:///../src/image.ts","webpack:///../src/events/swipe.ts","webpack:///../src/events/longTap.ts","webpack:///../src/events/singleTap.ts","webpack:///../src/events/doubleTap.ts","webpack:///../src/events/touchStart.ts","webpack:///../src/events/touchMove.ts","webpack:///../src/events/touchEnd.ts","webpack:///../src/events/index.ts","webpack:///../src/gallery.ts","webpack:///../src/index.ts"],"sourcesContent":["/*\n * @Author: Huangjs\n * @Date: 2023-06-26 09:46:00\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-28 15:49:45\n * @Description: ******\n */\n\n// 解决0.1+0.2不等于0.3的问题\nexport function fixDecimal(value: number, places: number = 15) {\n  const multiple = Math.pow(10, places);\n  return Math.round(value * multiple) / multiple;\n}\n// 算出双击时offset的比例\nexport function ratioOffset(v: number, k: number, t: number) {\n  if (v <= (1 - k) / (2 * k)) {\n    return -1 / 2;\n  } else if (v >= (1 + k - 2 * t) / (2 * k)) {\n    return 1 / 2;\n  } else {\n    return (v - (1 - t) / (2 * k)) / (1 - t / k);\n  }\n}\n// 传入的a是函数，就返回函数执行结果，否则直接返回a\nexport function effectuate(fn: any, ...args: any) {\n  return typeof fn === 'function' ? fn(...args) : fn;\n}\n// 判断v是否在min和max之间\nexport function isBetween(v: number, [min, max]: number[]) {\n  return min <= v && v <= max;\n}\n// 若v在min和max之间，则返回v值，否则，返回边缘值min或max\nexport function between(v: number, [min, max]: number[], _?: boolean) {\n  return Math.max(Math.min(v, max), min);\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 17:09:06\n * @Description: ******\n */\n\nimport Transition, {\n  TAProperty,\n  TAIOptions,\n  easeOutQuad,\n  easeOutQuart,\n  type EaseFn,\n} from '@huangjs888/transition';\nimport Transform, { type TransformRaw } from '@huangjs888/transform';\nimport { revokeDamping, performDamping } from '@huangjs888/damping';\nimport { between, isBetween, effectuate, ratioOffset } from './utils';\n\nclass Entity {\n  _element: HTMLElement;\n  _transform: Transform; // 当前手势操作之后的变换对象\n  _transition: Transition; // 当前渐变对象\n  _dblAdjust: boolean = true;\n  _dblScale: number | (() => number) = 0; // 双击放大比例和是否调整放大时的中心点\n  _damping: Damping[] = []; // 可以进行阻尼的变换\n  _rotation: number[] | (() => number[]) = []; // 旋转范围\n  _scalation: number[] | (() => number[]) = []; // 缩放范围\n  _translation: (number[] | ((v: number) => number[]))[] = []; // 平移范围\n  _sizeInfo: SizeInfo & {\n    elementWidth: number;\n    elementHeight: number;\n  } = {\n    containerCenter: [0, 0],\n    containerWidth: 0,\n    containerHeight: 0,\n    naturalWidth: 0,\n    naturalHeight: 0,\n    elementWidth: 0,\n    elementHeight: 0,\n  };\n  constructor({\n    element,\n    sizeInfo,\n    dblAdjust,\n    dblScale,\n    damping,\n    rotation,\n    scalation,\n    translation,\n  }: IOption) {\n    let _element: HTMLElement | null | undefined;\n    try {\n      if (typeof element === 'string') {\n        _element = document.querySelector(element) as HTMLElement;\n      } else {\n        _element = element;\n      }\n    } catch (e) {\n      _element = null;\n    }\n    if (!_element || !(_element instanceof HTMLElement)) {\n      _element = document.createElement('div');\n    }\n    _element.style.opacity = '0';\n    _element.innerHTML = '';\n    this._element = _element;\n    this._transform = new Transform({ a: 0, k: 1, x: 0, y: 0 });\n    // 创建过渡\n    this._transition = new Transition({\n      element: this._element,\n      propertyName: 'transform',\n      propertyValue: new (class extends TAProperty {\n        toString() {\n          // 这里注意，在不存在任何过渡动画的时候，这里的this.value应该和上面的this._transform内的每项值应该是相等的\n          // 但是由于 0.1+0.2!==0.3 的问题，导致经过各种计算后，其值并不是完全相等，存在极小的精度问题\n          return new Transform(this.value).toString();\n        }\n      })(this._transform.toRaw()),\n    });\n    this.setSizeInfo(sizeInfo); // 设置尺寸\n    this.setDblAdjust(dblAdjust); // 设置双击是否调整中心点\n    this.setDamping(damping); // 设置[]，则全都不阻尼\n    this.setDblScale(dblScale); // 设置1，则不进行双击缩放，但可双击归位\n    this.setRotation(rotation); // 设置相同数字（比如0），则不允许旋转，该数字为初始旋转\n    this.setScalation(scalation); // 设置相同数字（比如1），则不允许缩放，该数为初始缩放\n    this.setTranslation(translation); // 设置相同数字（比如0），则不允许平移，该数为初始位置\n  }\n  getElement() {\n    return this._element;\n  }\n  getTransform() {\n    return this._transform;\n  }\n  getSizeInfo() {\n    return this._sizeInfo;\n  }\n  setSizeInfo(sizeInfo?: SizeInfo) {\n    if (sizeInfo) {\n      const {\n        containerCenter,\n        containerWidth,\n        containerHeight,\n        naturalWidth,\n        naturalHeight,\n      } = sizeInfo;\n      const aspectRatio = naturalWidth / naturalHeight;\n      const boxAspectRatio = containerWidth / containerHeight;\n      let width = naturalWidth;\n      if (aspectRatio >= boxAspectRatio) {\n        width = containerWidth;\n      } else if (aspectRatio >= 1 / 2.2) {\n        // 0.4545454545...\n        //微信 iphone 横竖屏和微信 android 竖屏时\n        width = containerHeight * aspectRatio;\n      } /* else if (aspectRatio >= 0.4) {\n        // 微信 android 横屏时\n        width = containerHeight * aspectRatio;\n      } */ else {\n        // 微信 iphone 是取 containerWidth 和 naturalWidth 最小值\n        width = Math.min(containerWidth, naturalWidth);\n        // 微信 android 直接是取 containerWidth;\n        // width = containerWidth;\n      }\n      const height = width / aspectRatio;\n      this._element.style.opacity = '1';\n      this._element.style.width = `${width}px`;\n      this._element.style.height = `${height}px`;\n      this._sizeInfo = {\n        containerCenter,\n        containerWidth,\n        containerHeight,\n        naturalWidth,\n        naturalHeight,\n        elementWidth: width,\n        elementHeight: height,\n      };\n      const a = between(0, this.getRotation()); // 初始角度a\n      const k = between(1, this.getScalation()); // 初始比例k\n      const x = between(0, this.getXTranslation(k)); // 初始位移x\n      const y = between(0, this.getYTranslation(k)); //初始位移y\n      this.transitionRun({ a, k, x, y }, { duration: 0 });\n    }\n  }\n  setRotation(a?: number[]) {\n    if (\n      a &&\n      typeof a[0] === 'number' &&\n      typeof a[1] === 'number' &&\n      a[1] >= a[0]\n    ) {\n      // 最大范围 -Infinity 到 + Infinity\n      this._rotation = a;\n      return;\n    }\n    // 测微信得到的结论，是不给旋转的\n    // 如果设置不合理，则取默认\n    this._rotation = () => [0, 0];\n  }\n  getRotation() {\n    return effectuate(this._rotation);\n  }\n  setScalation(k?: number[]) {\n    if (\n      k &&\n      typeof k[0] === 'number' &&\n      typeof k[1] === 'number' &&\n      k[1] >= k[0] &&\n      k[0] > 0\n    ) {\n      this._scalation = k; // 最大范围 0 到 +Infinity (不等于0)\n      return;\n    }\n    // 测微信得到的结论，最小值为1，最大值永远是双击值放大值的2倍\n    // 如果设置不合理，则取默认\n    this._scalation = () => [1, 2 * this.getDblScale()];\n  }\n  getScalation() {\n    return effectuate(this._scalation);\n  }\n  setTranslation(xy?: number[][]) {\n    this.setXTranslation(xy && xy[0]);\n    this.setYTranslation(xy && xy[1]);\n  }\n  getTranslation(k?: number) {\n    return [this.getXTranslation(k), this.getYTranslation()];\n  }\n  setXTranslation(x?: number[]) {\n    if (\n      x &&\n      typeof x[0] === 'number' &&\n      typeof x[1] === 'number' &&\n      x[1] >= x[0]\n    ) {\n      this._translation[0] = x; // 最大范围 -Infinity 到 + Infinity\n      return;\n    }\n    // 测微信得到的结论，边界范围是元素按照当前比例缩放后宽度和容器宽度之差，左右各一半的范围\n    this._translation[0] = (k: number) => {\n      const { containerWidth, elementWidth } = this.getSizeInfo();\n      const bx = Math.max((elementWidth * k - containerWidth) / 2, 0);\n      return [-bx, bx];\n    };\n  }\n  getXTranslation(k?: number) {\n    return effectuate(this._translation[0], k || this._transform.k || 1);\n  }\n  setYTranslation(y?: number[]) {\n    if (\n      y &&\n      typeof y[0] === 'number' &&\n      typeof y[1] === 'number' &&\n      y[1] >= y[0]\n    ) {\n      this._translation[1] = y; // 最大范围 -Infinity 到 +Infinity\n      return;\n    }\n    // 测微信得到的结论，边界范围是元素按照当前比例缩放后高度和容器高度之差，上下各一半的范围\n    this._translation[1] = (k: number) => {\n      const { containerHeight, elementHeight } = this.getSizeInfo();\n      const by = Math.max((elementHeight * k - containerHeight) / 2, 0);\n      return [-by, by];\n    };\n  }\n  getYTranslation(k?: number) {\n    return effectuate(this._translation[1], k || this._transform.k || 1);\n  }\n  setDblScale(k?: number) {\n    if (typeof k === 'number' && k > 0) {\n      this._dblScale = k;\n      return;\n    }\n    // 测微信得到的结论，双击放大比例是\n    // 1，容器宽/元素宽 和 容器高/元素高 的最大值\n    // 2，元素实际宽/容器宽 和 元素实际高/容器高 的最小值\n    // 3，在1、2两个值和数值2这三个之中的最大值\n    this._dblScale = () => {\n      const {\n        containerWidth,\n        containerHeight,\n        naturalWidth,\n        naturalHeight,\n        elementWidth,\n        elementHeight,\n      } = this.getSizeInfo();\n      return (\n        Math.max(\n          2,\n          Math.max(\n            containerWidth / elementWidth,\n            containerHeight / elementHeight,\n          ),\n          Math.min(\n            naturalWidth / containerWidth,\n            naturalHeight / containerHeight,\n          ),\n        ) || 1\n      );\n    };\n  }\n  getDblScale() {\n    return effectuate(this._dblScale);\n  }\n  setDblAdjust(aj: boolean = true) {\n    this._dblAdjust = aj;\n  }\n  getDblAdjust() {\n    return this._dblAdjust;\n  }\n  isDamping(key: Damping) {\n    return this._damping && this._damping.indexOf(key) !== -1;\n  }\n  setDamping(damping?: Damping[]) {\n    if (damping) {\n      this._damping = damping;\n      return;\n    }\n    // 如果不设置，默认只对缩放比例和位移进行阻尼\n    this._damping = ['scale', 'translate'];\n  }\n  rotate(a: number) {\n    // 负数顺时针，正数逆时针\n    // 在原来的基础上再旋转 a\n    return this.transform({ a });\n  }\n  rotateTo(a: number) {\n    // 负数顺时针，正数逆时针\n    // 直接旋转到 a\n    return this.transformTo({ a });\n  }\n  scale(k: number, point?: number[]) {\n    // 在原来的基础上相对 point 点缩放 k\n    return this.transform({ k }, point);\n  }\n  scaleTo(k: number, point?: number[]) {\n    // 直接相对 point 点缩放到 k\n    return this.transformTo({ k }, point);\n  }\n  translate(x: number, y: number) {\n    // 在原来的基础上平移 x, y\n    return this.transform({ x, y });\n  }\n  translateTo(x: number, y: number) {\n    // 直接平移到 x, y\n    return this.transformTo({ x, y });\n  }\n  translateX(x: number) {\n    // 在原来的基础上横向平移 x\n    return this.transform({ x });\n  }\n  translateXTo(x: number) {\n    // 直接横向平移到 x\n    return this.transformTo({ x });\n  }\n  translateY(y: number) {\n    // 在原来的基础上竖向平移  y\n    return this.transform({ y });\n  }\n  translateYTo(y: number) {\n    // 直接竖向平移到 y\n    return this.transformTo({ y });\n  }\n  transform(\n    transformRaw: TransformRaw,\n    point?: number[] | TAIOptions,\n    options?: TAIOptions,\n  ) {\n    const { a: ta = 0, k: tk = 1, x: tx = 0, y: ty = 0 } = this.getTransform();\n    let { a, k, x, y } = transformRaw;\n    if (typeof a === 'number') {\n      a += ta;\n    }\n    if (typeof k === 'number') {\n      k *= tk;\n    }\n    if (typeof x === 'number') {\n      x += tx;\n    }\n    if (typeof y === 'number') {\n      y += ty;\n    }\n    return this.transformTo({ a, k, x, y }, point, options);\n  }\n  transformTo(\n    transformRaw: TransformRaw,\n    point?: number[] | TAIOptions,\n    options?: TAIOptions,\n  ) {\n    let _point = point;\n    let _options = options;\n    if (!options && !Array.isArray(point)) {\n      _options = point;\n      _point = undefined;\n    }\n    const { a: _a, k: _k, x: _x, y: _y } = transformRaw;\n    const _transformRaw: TransformRaw = {};\n    if (typeof _a === 'number') {\n      _transformRaw.a = between(_a, this.getRotation());\n    }\n    if (typeof _k === 'number') {\n      const k = (_transformRaw.k = between(_k, this.getScalation()));\n      if (Array.isArray(_point)) {\n        const [ox, oy] = this.computeOffset(_point, k);\n        const { x: tx = 0, y: ty = 0 } = this._transform;\n        _transformRaw.x = between(\n          (typeof _x === 'number' ? _x : tx) + ox,\n          this.getXTranslation(k),\n        );\n        _transformRaw.y = between(\n          (typeof _y === 'number' ? _y : ty) + oy,\n          this.getYTranslation(k),\n        );\n      } else {\n        if (typeof _x === 'number') {\n          _transformRaw.x = between(_x, this.getXTranslation(k));\n        }\n        if (typeof _y === 'number') {\n          _transformRaw.y = between(_y, this.getYTranslation(k));\n        }\n      }\n    } else {\n      if (typeof _x === 'number') {\n        _transformRaw.x = between(_x, this.getXTranslation());\n      }\n      if (typeof _y === 'number') {\n        _transformRaw.y = between(_y, this.getYTranslation());\n      }\n    }\n    return this.transitionRun(_transformRaw, _options);\n  }\n  transitionRun(transformRaw: TransformRaw, options: TAIOptions = {}) {\n    if (typeof options.duration === 'number' && options.duration <= 0) {\n      // 这里移动时不需要动画，可以直接进行绑定赋值\n      this._transform = new Transform(transformRaw);\n      this._transition.bind(transformRaw);\n      return Promise.resolve(transformRaw);\n    }\n    const { a, k, x, y } = transformRaw;\n    const { a: ta = 0, k: tk = 1, x: tx = 0, y: ty = 0 } = this.getTransform();\n    const deltaValue: TransformRaw = {};\n    const precision: TransformRaw = {};\n    if (typeof a === 'number') {\n      deltaValue.a = (this._transform.a = a) - ta;\n      // 角度精度按照屏幕尺寸一般暂时设置为0.001\n      precision.a = 0.001;\n    }\n    if (typeof k === 'number') {\n      deltaValue.k = (this._transform.k = k) - tk;\n      // 缩放精度按照屏幕尺寸一般暂时设置为0.001\n      precision.k = 0.001;\n    }\n    if (typeof x === 'number') {\n      deltaValue.x = (this._transform.x = x) - tx;\n      // 像素精度都在1px\n      precision.x = 1;\n    }\n    if (typeof y === 'number') {\n      deltaValue.y = (this._transform.y = y) - ty;\n      // 像素精度都在1px\n      precision.y = 1;\n    }\n    return this._transition\n      .apply(deltaValue, {\n        precision,\n        cancel: true,\n        duration: 500,\n        easing: easeOutQuart,\n        ...options,\n      })\n      .then((value) => {\n        if (!this.isTransitioning()) {\n          // 在最后一个动画的最后一帧结束重新绑定一下过渡值，目的是为了让_transition里的value和_transform保持一致\n          this._transition.bind(this._transform.toRaw());\n        }\n        return value;\n      });\n  }\n  transitionCancel() {\n    // cancel返回值是动画未执行的部分\n    return this._transition.cancel().map((value) => {\n      // 取消动画时应该把this._transform内的值减掉还未执行的部分\n      const {\n        a: ta = 0,\n        k: tk = 1,\n        x: tx = 0,\n        y: ty = 0,\n      } = this.getTransform();\n      Object.keys(value).forEach((key) => {\n        const val = value[key];\n        if (key === 'a') {\n          this._transform.a = ta - val;\n        } else if (key === 'k') {\n          this._transform.k = tk - val;\n        } else if (key === 'x') {\n          this._transform.x = tx - val;\n        } else if (key === 'y') {\n          this._transform.y = ty - val;\n        }\n      });\n    }).length;\n  }\n  isTransitioning() {\n    return this._transition.transitioning();\n  }\n  computeOffset(point: number[], k: number, adjust: boolean = false) {\n    const {\n      containerCenter,\n      containerWidth,\n      containerHeight,\n      elementWidth,\n      elementHeight,\n    } = this.getSizeInfo();\n    const { k: tk = 1, x: tx = 0, y: ty = 0 } = this.getTransform();\n    const dk = k / tk;\n    const [cx, cy] = containerCenter;\n    let ox = point[0] - (cx + tx);\n    let oy = point[1] - (cy + ty);\n    if (adjust) {\n      // 思路：对元素进行划线分界\n      // 1，在元素上边的时候，用元素实际高度一半(eh/2)的基础上在除以双击比例 k 即 eh/2k 作为上分界线，分界线到元素上边缘区域内点击，全部视为在元素上边缘线上点击，即放大后元素上边缘会紧贴在容器上边缘\n      // 2，在元素下边的时候，先用容器的高(ch)比上元素实际高(eh)，即ch/eh（但是这个比例值只能在1和2之间（即只针对元素高小于容器高且大于容器高一半的情况）），用这个比例减去1/2k，得到的结果乘以元素实际高(eh)，再以此作为下分界线，分界线到元素下边缘区域内点击，全部视为在元素下边缘线上点击，即放大后元素下边缘会紧贴在容器下边缘\n      // 3，找出元素在不受偏移量和边界限制的影响下，点击元素中心点放大后，元素上下各存在一条界线正好与容器边缘重合，计算出该界线到中心点的距离，该距离一定是在元素中心点到元素边缘之间即0,ew/2之间，并且两条界线等距\n      // 4，在1，2中算出的上下分界线之间内点击，计算均匀分布对应到在3中算出的上下界线之间内点击，分界线中点处对应元素中点处，最后得到对应的偏移量oy\n      // 5，元素左右计算方式如同上下方式一样得到ox\n      // 测微信得到的结论\n      // 这个偏移量需要要向着边缘点发散\n      const cw = containerWidth / 1;\n      const ch = containerHeight / 1;\n      const ew = elementWidth / tk;\n      const eh = elementHeight / tk;\n      ox =\n        between(ew - (cw - ew) / (dk - 1), [0, ew]) *\n          ratioOffset(ox / ew, dk, between(cw / ew, [1, 2])) || 0;\n      oy =\n        between(eh - (ch - eh) / (dk - 1), [0, eh]) *\n          ratioOffset(oy / eh, dk, between(ch / eh, [1, 2])) || 0;\n    }\n    ox *= 1 - dk;\n    oy *= 1 - dk;\n    return [ox, oy];\n  }\n  move(\n    point: number[],\n    angle: number,\n    scale: number,\n    deltaX: number,\n    deltaY: number,\n  ) {\n    let { a = 0, k = 1, x = 0, y = 0 } = this.getTransform();\n    const aRange = this.getRotation();\n    if (this.isDamping('rotate')) {\n      // 先把当前值反算出阻尼之前的原值\n      let ba = between(a, aRange);\n      a = ba + revokeDamping(a - ba, { max: 180 });\n      // 再对总值进行总体阻尼计算\n      ba = between((a += angle), aRange);\n      a = ba + performDamping(a - ba, { max: 180 });\n    } else {\n      a = between((a += angle), aRange);\n    }\n    const kRange = this.getScalation();\n    if (this.isDamping('scale')) {\n      // 先把当前值反算出阻尼之前的原值\n      let bk = between(k, kRange);\n      k = bk * revokeDamping(k / bk, { max: 2, mode: 1 });\n      // 再对总值进行总体阻尼计算\n      bk = between((k *= scale), kRange);\n      k = bk * performDamping(k / bk, { max: 2, mode: 1 });\n    } else {\n      k = between((k *= scale), kRange);\n    }\n    const [ox, oy] = this.computeOffset(point, k);\n    if (this.isDamping('scale')) {\n      // 先把当前值反算出阻尼之前的原值\n      const xMax = this._sizeInfo.containerWidth;\n      let bx = between(x, this.getXTranslation());\n      x = bx + revokeDamping(x - bx, { max: xMax });\n      // 再对总值进行总体阻尼计算\n      bx = between((x += ox + deltaX), this.getXTranslation(k));\n      x = bx + performDamping(x - bx, { max: xMax });\n      // 先把当前值反算出阻尼之前的原值\n      const yMax = this._sizeInfo.containerHeight;\n      let by = between(y, this.getYTranslation());\n      y = by + revokeDamping(y - by, { max: yMax });\n      // 再对总值进行总体阻尼计算\n      by = between((y += oy + deltaY), this.getYTranslation(k));\n      y = by + performDamping(y - by, { max: yMax });\n    } else {\n      x = between((x += ox + deltaX), this.getXTranslation(k));\n      y = between((y += oy + deltaY), this.getYTranslation(k));\n    }\n    this.transitionRun({ a, k, x, y }, { duration: 0 });\n  }\n  reset(point: number[] = [0, 0], cancel: boolean = false) {\n    let { a = 0, k = 1, x = 0, y = 0 } = this.getTransform();\n    // 若允许阻尼，首先应该先把当前值反算出阻尼之前的原值\n    if (this.isDamping('rotate')) {\n      const ba = between(a, this.getRotation());\n      a = ba + revokeDamping(a - ba, { max: 180 });\n    }\n    if (this.isDamping('scale')) {\n      const bk = between(k, this.getScalation());\n      k = bk * revokeDamping(k / bk, { max: 2, mode: 1 });\n    }\n    if (this.isDamping('translate')) {\n      const xMax = this._sizeInfo.containerWidth;\n      const bx = between(x, this.getXTranslation());\n      x = bx + revokeDamping(x - bx, { max: xMax });\n      const yMax = this._sizeInfo.containerHeight;\n      const by = between(y, this.getYTranslation());\n      y = by + revokeDamping(y - by, { max: yMax });\n    } // 重置之前是双指移动，是不允许取消动画的\n    this.transformTo({ a, k, x, y }, point, { cancel });\n  }\n  dblScale(point: number[] = [0, 0]) {\n    // 这三个比例都是用保留三位小数的结果进行比较\n    // 其实这里的3应该用1/屏幕的宽高算出的小数位数\n    // 此刻比例和位移\n    const tk = this.getTransform().k || 1;\n    // 双击变化的比例\n    const dk = between(this.getDblScale(), this.getScalation());\n    // 再次双击恢复的比例（初始比例）\n    const bk = between(1, this.getScalation());\n    // 双击变化（如果设置的双击比例大于初始比例并且此刻比例小于或等于初始比例\n    // 或者设置的双击比例小于初始比例且此刻比例大于或等于初始比例）\n    if ((dk > bk && tk <= bk) || (dk < bk && tk >= bk)) {\n      if (this.getDblAdjust()) {\n        // 需要调整的情况，自己算偏移量，并且旋转置为0\n        const [ox, oy] = this.computeOffset(point, dk, this.getDblAdjust());\n        const { x: tx = 0, y: ty = 0 } = this.getTransform();\n        this.transformTo(\n          { a: 0, k: dk, x: tx + ox, y: ty + oy },\n          { cancel: false },\n        );\n      } else {\n        // 交给transformTo\n        this.transformTo({ k: dk }, point, { cancel: false });\n      }\n    } else {\n      // 再次双击恢复\n      if (this.getDblAdjust()) {\n        // 需要调整的情况，置为初始状态\n        this.transformTo({ a: 0, k: bk, x: 0, y: 0 }, { cancel: false });\n      } else {\n        // 交给transformTo\n        this.transformTo({ k: bk }, point, { cancel: false });\n      }\n    }\n  }\n  swipeBounce(\n    duration: number,\n    stretch: number,\n    key: 'x' | 'y',\n    transition?: (\n      key: 'x' | 'y',\n      xySwipe: number,\n      xyBounce: number,\n      option: (v: number) => { duration: number; easing: EaseFn },\n    ) => void,\n  ) {\n    const maxBounce =\n      this._sizeInfo[key === 'x' ? 'containerWidth' : 'containerHeight'];\n    const xyScale = 1.2 * this.getDblScale();\n    const xyPos = this.getTransform()[key] || 0;\n    const xyRange = this.getTranslation()[key === 'x' ? 0 : 1];\n    const sign = stretch > 0 ? 1 : -1;\n    // 对距离进行优化(最大值是当前双击比例下图片宽度)\n    const _stretch =\n      Math.max(1, Math.min(Math.abs(stretch), xyScale * maxBounce)) * sign;\n    // 对时间进行优化\n    const _duration = Math.max(800, Math.min(2500, duration));\n    if (isBetween(xyPos + _stretch, xyRange)) {\n      // 如果加上惯性滑动距离之后图片未超出边界，则图片直接移动\n      this.transitionRun(\n        { [key]: xyPos + _stretch },\n        { easing: easeOutQuad, duration: _duration },\n      );\n    } else {\n      // 根据边界算出到达边界要走的的距离，有可能松开时已经超出边界，此时xySwipe是需要减掉的超出部分距离\n      const xySwipe = between(xyPos + _stretch, xyRange) - xyPos;\n      let xyBounce = 0;\n      if (this.isDamping('translate')) {\n        // 计算速度时，如果松开时超出边界，xySwipe视作0，其实得到的就是初始速度\n        const velocity =\n          (isBetween(xyPos, xyRange)\n            ? Math.sqrt(1 - Math.abs(xySwipe / _stretch))\n            : 1) *\n          ((2 * Math.abs(_stretch)) / _duration);\n        // 根据到达边界时速度的大小计算出将要Damping的距离（一个与速度成正比计算方式，最大值不能超过容器宽度的1/4）\n        xyBounce = Math.min(30 * velocity, maxBounce / 4) * sign;\n      }\n      if (typeof transition === 'function') {\n        // 交给调用者去计算分配如何transition，并使用回调计算transition配置\n        transition(key, xySwipe, xyBounce, (xyMove: number) => {\n          // 根据实际走的距离xyMove算出时间占比\n          const kt = 1 - Math.sqrt(1 - Math.abs(xyMove / _stretch));\n          return {\n            duration: kt * _duration,\n            easing: easeOutQuad,\n          };\n        });\n      } else {\n        // 如果松开时超出边界，相当于在xyBounce里减掉超出的部分得到的结果，如果超出很多，远远大于xyBounce，则直接就是0\n        const xyMove = Math.max((xySwipe + xyBounce) * sign, 0) * sign;\n        // 整个减速运动中，移动xyMove的时间占比\n        const kt = 1 - Math.sqrt(1 - Math.abs(xyMove / _stretch));\n        if (xyMove === 0) {\n          // 如果swipe抬起没有移动的距离，则直接归位\n          this.transitionRun({ [key]: between(xyPos + xyMove, xyRange) });\n        } else {\n          // 先移动xyMove距离\n          this.transitionRun(\n            { [key]: xyPos + xyMove },\n            {\n              duration: kt * _duration,\n              easing: easeOutQuad,\n            },\n          ).then(() => {\n            // 移动后归位\n            this.transitionRun({ [key]: between(xyPos + xyMove, xyRange) });\n          });\n        }\n      }\n    }\n  }\n}\n\nexport type Damping = 'rotate' | 'scale' | 'translate';\nexport type SizeInfo = {\n  containerCenter: number[];\n  containerWidth: number;\n  containerHeight: number;\n  naturalWidth: number;\n  naturalHeight: number;\n};\nexport type IOption = {\n  element?: HTMLElement | string;\n  sizeInfo?: SizeInfo; // 容器尺寸和元素实际尺寸\n  dblAdjust?: boolean; // 双击中心点是否调整\n  dblScale?: number; // 双击放大比例\n  damping?: Damping[]; // 哪些操作超出边界可以进行阻尼效果，如果对rotate,scale,translate设置了无边界限制(Infinity)，则阻尼无效\n  scalation?: number[]; // 缩放范围 [0.1, 10]，最小比例0.1和最大比例10\n  translation?: number[][]; // 平移范围 [[-10, 20], [-20, 10]]，x最小-10，最大20，y最小-20，最大10\n  rotation?: number[]; // 旋转范围 [-10, 20]，逆时针可旋转20度和顺时针可旋转10度\n};\n\nexport default Entity;\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 13:44:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-28 13:51:09\n * @Description: ******\n */\nexport const loadingIcon = `\n  <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 80 80\">\n    <defs>\n      <linearGradient\n        x1=\"94.0869141%\"\n        y1=\"0%\"\n        x2=\"94.0869141%\"\n        y2=\"90.559082%\"\n        id=\"linearGradient-1\"\n      >\n        <stop stop-color=\"#fff\" stop-opacity=\"0\" offset=\"0%\" />\n        <stop stop-color=\"#fff\" stop-opacity=\"0.3\" offset=\"100%\" />\n      </linearGradient>\n      <linearGradient\n        x1=\"100%\"\n        y1=\"8.67370605%\"\n        x2=\"100%\"\n        y2=\"90.6286621%\"\n        id=\"linearGradient-2\"\n      >\n        <stop stop-color=\"#fff\" offset=\"0%\" />\n        <stop stop-color=\"#fff\" stop-opacity=\"0.3\" offset=\"100%\" />\n      </linearGradient>\n    </defs>\n    <g\n      stroke=\"none\"\n      stroke-width=\"1\"\n      fill=\"none\"\n      fill-rule=\"evenodd\"\n      opacity=\"0.9\"\n    >\n      <g>\n        <path\n          d=\"M40,0 C62.09139,0 80,17.90861 80,40 C80,62.09139 62.09139,80 40,80 L40,73 C58.2253967,73 73,58.2253967 73,40 C73,21.7746033 58.2253967,7 40,7 L40,0 Z\"\n          fill=\"url(#linearGradient-1)\"\n        />\n        <path\n          d=\"M40,0 L40,7 C21.7746033,7 7,21.7746033 7,40 C7,58.2253967 21.7746033,73 40,73 L40,80 C17.90861,80 0,62.09139 0,40 C0,17.90861 17.90861,0 40,0 Z\"\n          fill=\"url(#linearGradient-2)\"\n        />\n        <circle id=\"Oval\" fill=\"#fff\" cx=\"40.5\" cy=\"3.5\" r=\"3.5\" />\n      </g>\n      <animateTransform\n        attributeName=\"transform\"\n        begin=\"0s\"\n        dur=\"1s\"\n        type=\"rotate\"\n        values=\"0 40 40;360 40 40\"\n        repeatCount=\"indefinite\"\n      />\n    </g>\n  </svg>\n`;\nexport const loadingIcon2 = `\n  <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 32 32\">\n    <circle\n      cx=\"16\"\n      cy=\"16\"\n      r=\"14\"\n      fill=\"none\"\n      stroke=\"#666\"\n      stroke-width=\"4\"\n    />\n    <circle\n      cx=\"16\"\n      cy=\"16\"\n      r=\"14\"\n      fill=\"none\"\n      stroke=\"#fff\"\n      stroke-width=\"4\"\n      stroke-dasharray=\"30\"\n      stroke-dashoffset=\"30\"\n      stroke-linecap=\"round\"\n    />\n    <animateTransform\n      attributeName=\"transform\"\n      dur=\"1s\"\n      type=\"rotate\"\n      from=\"0\" to=\"360\"\n      repeatCount=\"indefinite\"\n    />\n  </svg>\n`;\nexport const errorIcon = `\n  <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 24 24\" fill=\"#fff\">\n    <path\n      d=\"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.763-15.864l.11 7.596h1.305l.11-7.596h-1.525zm.759 10.967c.512 0 .902-.383.902-.882 0-.5-.39-.882-.902-.882a.878.878 0 00-.896.882c0 .499.396.882.896.882z\" />\n  </svg>\n`;\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-28 16:58:10\n * @Description: ******\n */\n\nimport { loadingIcon, errorIcon } from './svgIcon';\n\nconst autoPxReg =\n  /^(?:-border(?:-top|-right|-bottom|-left)?(?:-width|)|(?:-margin|-padding)?(?:-top|-right|-bottom|-left)?|(?:-min|-max)?(?:-width|-height))$/;\nexport function setStyle(\n  ele: HTMLElement,\n  css: { [key: string]: string | number | undefined },\n) {\n  if (ele) {\n    Object.keys(css).forEach((k: string) => {\n      if (typeof css[k] === 'undefined') {\n        return;\n      }\n      const key = k.replace(/([A-Z])/g, '-$1').toLowerCase();\n      const val =\n        typeof css[k] === 'number' &&\n        /^[a-z]/.test(key) &&\n        autoPxReg.test(`-${key}`)\n          ? `${css[k]}px`\n          : String(css[k]);\n      ele.style.setProperty(key, val);\n    });\n  }\n  return ele;\n}\n\nexport function createContainer(element?: HTMLElement | string) {\n  let ele: HTMLElement | null | undefined;\n  try {\n    if (typeof element === 'string') {\n      ele = document.querySelector(element) as HTMLElement;\n    } else {\n      ele = element;\n    }\n  } catch (e) {\n    ele = null;\n  }\n  if (!ele || !(ele instanceof HTMLElement)) {\n    ele = setStyle(document.createElement('div'), {\n      position: 'fixed',\n      left: '0px',\n      top: '0px',\n      zIndex: '9999',\n      width: '100%',\n      height: '100%',\n      background: 'black',\n      overflow: 'hidden',\n      display: 'none',\n    });\n    document.body.appendChild(ele);\n  } else {\n    setStyle(ele, {\n      display: 'none',\n    });\n    ele.innerHTML = '';\n  }\n  return ele;\n}\n\nexport function createContent(isVertical: boolean, element: HTMLElement) {\n  const contentEl = setStyle(document.createElement('div'), {\n    display: 'flex',\n    flexDirection: isVertical ? 'column' : 'row',\n  });\n  element.appendChild(contentEl);\n  return contentEl;\n}\n\nexport function createIndicator(\n  isVertical: boolean,\n  hasIndicator: boolean,\n  element: HTMLElement,\n) {\n  let indicator = null;\n  if (hasIndicator) {\n    indicator = setStyle(document.createElement('div'), {\n      position: 'absolute',\n      bottom: isVertical ? '0px' : '16px',\n      right: isVertical ? '16px' : 'auto',\n      width: isVertical ? 'auto' : '100%',\n      height: isVertical ? '100%' : 'auto',\n      display: 'flex',\n      flexDirection: isVertical ? 'column' : 'row',\n      justifyContent: 'center',\n      alignItems: 'center',\n    });\n    element.appendChild(indicator);\n  }\n  return indicator;\n}\n\nexport function createIndicatorItem(\n  isVertical: boolean,\n  element: HTMLElement | null,\n) {\n  let item = null;\n  if (element) {\n    item = setStyle(document.createElement('span'), {\n      borderRadius: '100%',\n      width: 7,\n      height: 7,\n      display: 'inline-block',\n      margin: isVertical ? '5px 0' : '0 5px',\n      background: '#fff',\n      opacity: 0.6,\n    });\n    element.appendChild(item);\n  }\n  return item;\n}\n\nexport function createWrapper(\n  isFirst: boolean,\n  isVertical: boolean,\n  hasLoading: boolean,\n  itemGap: number,\n  element: HTMLElement,\n) {\n  const wrapper = setStyle(document.createElement('div'), {\n    position: 'relative',\n    display: 'flex',\n    width: '100%',\n    height: '100%',\n    justifyContent: 'center',\n    alignItems: 'center',\n    overflow: 'hidden',\n    flex: 1,\n    marginTop: isVertical && !isFirst ? itemGap : 0,\n    marginLeft: isVertical || isFirst ? 0 : itemGap,\n  });\n  if (hasLoading) {\n    const loading = setStyle(document.createElement('span'), {\n      position: 'absolute',\n      top: '50%',\n      left: '50%',\n      marginTop: -16,\n      marginLeft: -16,\n      width: 32,\n      height: 32,\n      display: 'inline-block',\n    });\n    loading.innerHTML = loadingIcon;\n    wrapper.appendChild(loading);\n  }\n  element.appendChild(wrapper);\n\n  return wrapper;\n}\n\nexport function createError(element: HTMLElement) {\n  const error = setStyle(document.createElement('div'), {\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    transform: 'translate3d(-50%,-50%,0)',\n    width: '100%',\n    color: '#fff',\n    fontSize: '14px',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center',\n    alignItems: 'center',\n    opacity: 0.88,\n  });\n  error.innerHTML = `\n    <span style=\"width: 72px;height: 72px;\">\n      ${errorIcon}\n    </span>\n    <span style=\"margin-top:16px;\">图片加载失败</span>\n  `;\n  element.appendChild(error);\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-28 17:26:59\n * @Description: ******\n */\n\nimport loadImage from '@huangjs888/load-image';\nimport Entity, { type IOption } from './entity';\nimport { createError } from './dom';\n\nexport default function loadImage2(image: Image) {\n  const { wrapper, entity, url, options } = image || {};\n  // 未定义表示还未加载过图片，null表示已经加载了，只是还没加载完或加载失败\n  if (typeof entity === 'undefined') {\n    image.entity = null;\n    return loadImage(url)\n      .then((ele) => {\n        image.entity = new Entity({\n          element: ele,\n          ...options,\n        });\n        image.width = ele.naturalWidth;\n        image.height = ele.naturalHeight;\n        wrapper.innerHTML = '';\n        wrapper.appendChild(ele);\n        return true;\n      })\n      .catch(() => {\n        // 这里可以加一个错误的提示\n        wrapper.innerHTML = '';\n        createError(wrapper);\n      });\n  }\n  return Promise.resolve();\n}\n\nexport type Image = {\n  wrapper: HTMLElement;\n  indicator?: HTMLElement | null;\n  entity?: Entity | null;\n  url: string;\n  width: number;\n  height: number;\n  options: IOption;\n};\n\nexport type ImageOption = IOption;\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 15:59:37\n * @Description: ******\n */\n\nimport { type GEvent } from '@huangjs888/gesture';\nimport { type EaseFn } from '@huangjs888/transition';\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\n\nexport default function swipe(this: Gallery | SingleGallery, e: GEvent) {\n  if (this instanceof Gallery) {\n    if (this.isTransitioning()) {\n      return;\n    }\n    const { entity } = (this._images && this._images[this._activeIndex]) || {};\n    if (this._moveTarget === 'inside' && entity) {\n      if (entity.isTransitioning()) {\n        return;\n      }\n      const { velocity = 0, swipeComputed } = e;\n      if (velocity > 0 && swipeComputed) {\n        const transition = (\n          key: 'x' | 'y',\n          xySwipe: number,\n          xyBounce: number,\n          option: (v: number) => { duration: number; easing: EaseFn },\n        ) => {\n          if (this instanceof Gallery) {\n            const translate = -this._activeIndex * this.getItemSize();\n            // 不等于0，表示未达到边界\n            if (xySwipe !== 0) {\n              const { duration, easing } = option(xySwipe + xyBounce);\n              // 因为是两个过渡，这里同时触发，分别在before里设置先后发生，使两个过度连贯进行\n              Promise.all([\n                // 图片走到边界距离xySwipe\n                entity.transitionRun(\n                  { [key]: (entity.getTransform()[key] || 0) + xySwipe },\n                  {\n                    duration,\n                    easing,\n                    before: (progress) => {\n                      // 先走 xySwipe ，走完之后，后面就一直 1\n                      // 根据总路程 xySwipe + xyBounce，计算走 xySwipe 实际的进度\n                      const s = Math.abs(xySwipe);\n                      const sb = Math.abs(xySwipe + xyBounce);\n                      return Math.min(sb * progress, s) / s;\n                    },\n                  },\n                ),\n                // 外部走damping距离xyBounce\n                this.transitionRun(this._translate + xyBounce, {\n                  duration,\n                  easing,\n                  before: (progress) => {\n                    // 后走 xyBounce ，没走之前，前面一直 0\n                    // 根据总路程 xySwipe + xyBounce，计算走 xyBounce 的实际的进度\n                    const s = Math.abs(xySwipe);\n                    const b = Math.abs(xyBounce);\n                    const sb = Math.abs(xySwipe + xyBounce);\n                    return Math.max(sb * progress - s, 0) / b;\n                  },\n                }),\n              ]).then(() => {\n                // 外部归位\n                if (this instanceof Gallery) {\n                  this.transitionRun(translate);\n                }\n              });\n            } else {\n              // 已经Damping的部分，即超出部分的距离\n              const diff = this._translate - translate;\n              const sign = diff > 0 ? 1 : -1;\n              // 如果松开时超出边界，相当于在xyBounce里减掉超出的部分得到的结果，如果超出很多，远远大于xyBounce，则直接就是0\n              const xyMove = Math.max((xyBounce - diff) * sign, 0) * sign;\n              const { duration, easing } = option(xyMove);\n              if (xyMove === 0) {\n                // 外部直接归位\n                this.transitionRun(translate);\n              } else {\n                this.transitionRun(this._translate + xyMove, {\n                  duration,\n                  easing,\n                }).then(() => {\n                  // 外部归位\n                  if (this instanceof Gallery) {\n                    this.transitionRun(translate);\n                  }\n                });\n              }\n            }\n          }\n        };\n        // 按照0.003的减速度减速运行得到减速到0时的时间和x，y方向的分量距离\n        const { duration, stretchX, stretchY } = swipeComputed(0.003);\n        if (this._direction === 'vertical') {\n          const xRange = entity.getXTranslation();\n          // 竖向的时候固定x\n          if (!(xRange[0] === 0 && xRange[1] === 0)) {\n            entity.swipeBounce(duration, stretchX, 'x');\n          }\n          entity.swipeBounce(duration, stretchY, 'y', transition);\n        } else {\n          entity.swipeBounce(duration, stretchX, 'x', transition);\n          const yRange = entity.getYTranslation();\n          // 横向的时候固定y\n          if (!(yRange[0] === 0 && yRange[1] === 0)) {\n            entity.swipeBounce(duration, stretchY, 'y');\n          }\n        }\n      }\n      return;\n    }\n    if (this._moveTarget === 'closures') {\n      if (entity && entity.isTransitioning()) {\n        return;\n      }\n      // 如果滑动方向是向下的或向右的，执行关闭操作\n      if (\n        e.direction === 'Down' &&\n        this._events &&\n        typeof this._events.downSwipe === 'function'\n      ) {\n        if (this._events.downSwipe()) {\n          this._moveTarget = 'none';\n        }\n      }\n    } else {\n      const size = this.getItemSize();\n      const index = size === 0 ? 0 : -this._translate / this.getItemSize();\n      this.slide(\n        index > this._activeIndex ? Math.ceil(index) : Math.floor(index),\n      );\n      // @@@2： 此处逻辑和touchstart手势函数里 @@@1 逻辑是处理里同一个问题（二选一，微信用的是@@@1效果）\n      // 这里是在真正要slide到上(下)一张时恢复到边界，那里是在手指放上去时直接恢复到边界\n      // 在非边缘图片damping恢复时，此时手指放上去后，恢复动画停止了\n      // 但是如果此时手指移动操作命中外部swipe到上(下)一张的逻辑，则内部图片的damping无法恢复到边界\n      // 因为此时swipe手势函数内正在执行上(下)一张图片过渡，touchend内reset不会被执行\n      /* if (entity) {\n        // 这里在slide时把内部图片reset\n        entity.reset();\n      } */\n    }\n  } else {\n    const { entity } = this._image || {};\n    if (entity) {\n      if (entity.isTransitioning()) {\n        return;\n      }\n      const { velocity = 0, swipeComputed } = e;\n      if (velocity > 0 && swipeComputed) {\n        // 按照0.003的减速度减速运行得到减速到0时的时间和x，y方向的分量距离\n        const { duration, stretchX, stretchY } = swipeComputed(0.003);\n        entity.swipeBounce(duration, stretchX, 'x');\n        entity.swipeBounce(duration, stretchY, 'y');\n      }\n    }\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 10:22:06\n * @Description: ******\n */\n\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\n\nexport default function longTap(this: Gallery | SingleGallery) {\n  if (this instanceof Gallery) {\n    if (this.isTransitioning()) {\n      return;\n    }\n    const { entity } = (this._images && this._images[this._activeIndex]) || {};\n    if (entity && entity.isTransitioning()) {\n      return;\n    }\n    if (this._events && typeof this._events.longTap === 'function') {\n      this._events.longTap();\n    }\n  } else {\n    const { entity } = this._image || {};\n    if (entity && entity.isTransitioning()) {\n      return;\n    }\n    if (this._events && typeof this._events.longTap === 'function') {\n      this._events.longTap();\n    }\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 11:28:19\n * @Description: ******\n */\n\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\n\nexport default function singleTap(this: Gallery | SingleGallery) {\n  if (this instanceof Gallery) {\n    if (this.isTransitioning()) {\n      return;\n    }\n    const { entity } = (this._images && this._images[this._activeIndex]) || {};\n    if (entity && entity.isTransitioning()) {\n      return;\n    }\n    if (this._events && typeof this._events.singleTap === 'function') {\n      this._events.singleTap();\n    }\n  } else {\n    const { entity } = this._image || {};\n    if (entity && entity.isTransitioning()) {\n      return;\n    }\n    if (this._events && typeof this._events.singleTap === 'function') {\n      this._events.singleTap();\n    }\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 09:36:16\n * @Description: ******\n */\n\nimport { type GEvent } from '@huangjs888/gesture';\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\n\nexport default function doubleTap(this: Gallery | SingleGallery, e: GEvent) {\n  if (this instanceof Gallery) {\n    if (this.isTransitioning()) {\n      return;\n    }\n    // diff===0表示目前没有进行任何move操作（使用Math.round，因为像素精确到1）\n    const translate = -this._activeIndex * this.getItemSize();\n    const diff = Math.round(this._translate - translate);\n    if (diff === 0) {\n      const { entity } =\n        (this._images && this._images[this._activeIndex]) || {};\n      if (entity) {\n        if (entity.isTransitioning()) {\n          return;\n        }\n        entity.dblScale(e.point);\n      }\n    }\n  } else {\n    const { entity } = this._image || {};\n    if (entity) {\n      if (entity.isTransitioning()) {\n        return;\n      }\n      entity.dblScale(e.point);\n    }\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 13:44:30\n * @Description: ******\n */\n\nimport { type GEvent } from '@huangjs888/gesture';\nimport { between, isBetween } from '../entity/utils';\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\n\nexport default function touchStart(this: Gallery | SingleGallery, e: GEvent) {\n  const { toucheIds } = e;\n  if (this._fgBehavior === 0 && toucheIds.length > 1) {\n    // 第一根手指放上去，紧接着再放一根手指（或者直接一下子放了两个手指），此时标记为2\n    this._fgBehavior = 2;\n  }\n  let stopCount = 0;\n  if (this instanceof Gallery) {\n    stopCount += this.transitionCancel();\n    const { entity } = (this._images && this._images[this._activeIndex]) || {};\n    const length = (this._images || []).length;\n    if (entity) {\n      stopCount += entity.transitionCancel();\n      // @@@1： 此处逻辑和swipe手势函数里 @@@2 逻辑是处理同一个问题（二选一，微信用的是这个效果）\n      // 这里是在手指放上去时直接恢复到边界，那边是在真正要slide到上(下)一张时恢复到边界\n      // 在非边缘图片damping恢复时，此时手指放上去后，恢复动画停止了\n      // 但是如果此时手指移动操作命中外部swipe到上(下)一张的逻辑，则内部图片的damping无法恢复到边界\n      // 因为此时swipe手势函数内正在执行上(下)一张图片过渡，touchend内reset不会被执行\n      const { x: tx = 0, y: ty = 0, ...rest } = entity.getTransform();\n      const [xRange, yRange] = entity.getTranslation();\n      // 是否是边缘图片\n      const isFirst = this._activeIndex === 0;\n      const isLast = this._activeIndex === length - 1;\n      if (this._direction === 'vertical') {\n        if (\n          !isBetween(tx, xRange) &&\n          ((ty <= yRange[0] && !isLast) || (ty >= yRange[1] && !isFirst))\n        ) {\n          // 非边缘图片，且y方向超出边界，x方向也超出边界的，x给予恢复到边界\n          entity.transitionRun(\n            { x: between(tx, xRange), y: ty, ...rest },\n            { duration: 0 },\n          );\n        }\n      } else {\n        if (\n          !isBetween(ty, yRange) &&\n          ((tx <= xRange[0] && !isLast) || (tx >= xRange[1] && !isFirst))\n        ) {\n          // 非边缘图片，且x方向超出边界，y方向也超出边界的，y给予恢复到边界\n          entity.transitionRun(\n            { x: tx, y: between(ty, yRange), ...rest },\n            { duration: 0 },\n          );\n        }\n      }\n    }\n  } else {\n    // 取消动画\n    const { entity } = this._image || {};\n    if (entity) {\n      stopCount += entity.transitionCancel();\n    }\n  }\n\n  if (stopCount > 0 && this._gesture) {\n    // 如果有动画停止，则本次点击或略，阻止所有单指点击相关事件\n    // 曲线救国 1：这里使用注入设置，以达到阻止的目的\n    this._gesture._preventTap = true;\n    this._gesture._preventSingleTap = true;\n    this._gesture._preventDoubleTap = true;\n    this._gesture._firstPoint = null;\n    if (this._gesture._longTapTimer) {\n      clearTimeout(this._gesture._longTapTimer);\n      this._gesture._longTapTimer = null;\n    }\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 16:59:15\n * @Description: ******\n */\n\nimport { type GEvent } from '@huangjs888/gesture';\nimport { revokeDamping, performDamping } from '@huangjs888/damping';\nimport { between } from '../entity/utils';\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\nimport { setStyle } from '../dom';\n\nconst isRightDown = (\n  direction: string,\n  [x0, y0]: number[],\n  [x1, y1]: number[],\n) => {\n  if (direction === 'vertical') {\n    return Math.abs(x0 - x1) > 4 * Math.abs(y0 - y1) && x0 - x1 <= 0;\n  } else {\n    console.log(\n      90 - (Math.atan(Math.abs(y0 - y1) / Math.abs(x0 - x1)) * 180) / Math.PI,\n    );\n    return Math.abs(y0 - y1) > 4 * Math.abs(x0 - x1) && y0 - y1 <= 0;\n  }\n};\n\nexport default function touchMove(this: Gallery | SingleGallery, e: GEvent) {\n  const { toucheIds } = e;\n  if (this._fgBehavior === 0 && toucheIds.length === 1) {\n    // 第一根手指放上去，然后直接移动，此时标记为1\n    this._fgBehavior = 1;\n  }\n  let oneFinger = false;\n  if (toucheIds.length === 1 || this._fgBehavior === 1) {\n    // 此时的多指move，视作单指move\n    // 曲线救国 2：这里使用注入设置，以达到使_rotateAngle不为number，避免了双指旋转\n    if (this._gesture) {\n      this._gesture._rotateAngle = null;\n    }\n    oneFinger = true;\n  }\n  const {\n    direction,\n    movePoint,\n    endPoint,\n    point,\n    angle = 0,\n    scale = 1,\n    deltaX = 0,\n    deltaY = 0,\n  } = e;\n  if (this instanceof Gallery) {\n    if (this.isTransitioning()) {\n      return;\n    }\n    const { entity, wrapper } =\n      (this._images && this._images[this._activeIndex]) || {};\n    const length = (this._images || []).length;\n    if (entity) {\n      if (entity.isTransitioning()) {\n        return;\n      }\n      const { x: tx = 0, y: ty = 0 } = entity.getTransform();\n      const [xRange, yRange] = entity.getTranslation();\n      // 如果x方向没有可以移动的范围，则判断向上还是向下使用deltaY的正负，否则使用direction值\n      const fixedX = xRange[0] === 0 && xRange[1] === 0;\n      // 如果y方向没有可以移动的范围，则判断向左还是向右使用deltaX的正负，否则使用direction值\n      const fixedY = yRange[0] === 0 && yRange[1] === 0;\n      if (this._moveTarget === 'none') {\n        // 多指或者不满足以下条件的，则做图片操作\n        this._moveTarget = 'inside';\n        if (oneFinger) {\n          // 是否是边缘图片\n          const isFirst = this._activeIndex === 0;\n          const isLast = this._activeIndex === length - 1;\n          const rightDown = isRightDown(this._direction, movePoint, endPoint);\n          // 单指行为时，根据图片位置，判断后续为外部swiper操作还是内部图片操作\n          if (this._direction === 'vertical') {\n            // 曲线救国 4：这里使用内部参数，主要是计算移动角度\n            if (tx >= xRange[1] && rightDown) {\n              this._moveTarget = 'closures';\n            } else {\n              // 如果x的范围是[0,0]，则判断上下移动，直接根据deltaY的正负\n              // 否则需要根据移动方向（因为移动方向是按照45度分开的）\n              const upMove = fixedX ? deltaY < 0 : direction === 'Up';\n              const downMove = fixedX ? deltaY > 0 : direction === 'Down';\n              // 如果图片上边抵达或超出上边界，仍然向下滑动（不是第一张图）\n              // 或者下边抵达或超出下边界，仍然向上滑动（不是最后一张图），则为swiper，反之为图片操作\n              // 因为第一张图片和最后一张都是边缘图片（边缘图片向两边swipe时，是没有上一张或下一张的），无需外部swipe操作，直接走内部图片操作\n              if (\n                (ty <= yRange[0] && upMove && !isLast) ||\n                (ty >= yRange[1] && downMove && !isFirst)\n              ) {\n                this._moveTarget = 'outside';\n              }\n            }\n          } else {\n            // 曲线救国 4：这里使用内部参数，主要是计算移动角度\n            if (ty >= yRange[1] && rightDown) {\n              this._moveTarget = 'closures';\n            } else {\n              // 如果y的范围是[0,0]，则判断左右移动，直接根据deltaX的正负\n              // 否则需要根据移动方向（因为移动方向是按照45度分开的）\n              const leftMove = fixedY ? deltaX < 0 : direction === 'Left';\n              const rightMove = fixedY ? deltaX > 0 : direction === 'Right';\n              // 如果图片左边抵达或超出左边界，仍然向右滑动（不是第一张图）\n              // 或者右边抵达或超出右边界，仍然向左滑动（不是最后一张图），则为swiper操作，反之为图片操作\n              if (\n                (tx <= xRange[0] && leftMove && !isLast) ||\n                (tx >= xRange[1] && rightMove && !isFirst)\n              ) {\n                this._moveTarget = 'outside';\n              }\n            }\n          }\n        }\n      }\n      // 进入内部图片操作\n      if (this._moveTarget === 'inside') {\n        const translate = -this._activeIndex * this.getItemSize();\n        // 计算出外部swiper移动的原始距离\n        const diff = revokeDamping(this._translate - translate, {\n          max: this.getItemSize(),\n        });\n        let _deltaX = deltaX;\n        let _deltaY = deltaY;\n        // 把swiper移动的原始距离加进去\n        if (this._direction === 'vertical') {\n          _deltaY += diff;\n        } else {\n          _deltaX += diff;\n        }\n        if (oneFinger) {\n          let _delta = 0;\n          if (this._direction === 'vertical') {\n            _delta = _deltaY;\n            // 竖向的时候固定x\n            _deltaX = fixedX ? 0 : _deltaX;\n            // 内部图片，最多移动到边界\n            _deltaY = between(_deltaY + ty, yRange) - ty;\n            // 超出部分由外部swiper移动\n            _delta -= _deltaY;\n          } else {\n            _delta = _deltaX;\n            // 内部图片，最多移动到边界\n            _deltaX = between(_deltaX + tx, xRange) - tx;\n            // 横向的时候固定y\n            _deltaY = fixedY ? 0 : _deltaY;\n            // 超出部分由外部swiper移动\n            _delta -= _deltaX;\n          }\n          // 内部图片需要移动的距离\n          entity.move(point, 0, 1, _deltaX, _deltaY);\n          // 外部swiper需要移动的距离\n          this.transitionRun(\n            translate + performDamping(_delta, { max: this.getItemSize() }),\n            { duration: 0 },\n          );\n        } else {\n          entity.move(point, angle, scale, _deltaX, _deltaY);\n          if (diff !== 0) {\n            // 多指移动前，将外部swiper移动的部分归位（内部image会把swiper的距离加进去）\n            this.transitionRun(translate, { duration: 0 });\n          }\n        }\n        return;\n      }\n    } else {\n      if (this._moveTarget === 'none') {\n        const rightDown = isRightDown(this._direction, movePoint, endPoint);\n        this._moveTarget = rightDown ? 'closures' : 'outside';\n      }\n    }\n    if (this._moveTarget === 'closures') {\n      if (this.container && this._rectSize) {\n        const { moveX = 0, moveY = 0 } = e;\n        const { width, height, left, top } = this._rectSize;\n        let sk = 1;\n        if (this._direction === 'vertical') {\n          sk = width === 0 ? 0 : moveX / width;\n        } else {\n          sk = height === 0 ? 0 : moveY / height;\n        }\n        const nk = Math.min(Math.max(1 - sk, 0.3), 1);\n        if (wrapper) {\n          let x = 0;\n          let y = 0;\n          let k = 1;\n          if (wrapper.style.transform) {\n            const styles = wrapper.style.transform.split('(');\n            const [xs, ys] = styles[1].split(')')[0].split(',');\n            const ks = styles[2].split(')')[0];\n            x = parseFloat(xs);\n            y = parseFloat(ys);\n            k = parseFloat(ks);\n          }\n          let ox = point[0] - (x + left + width / 2);\n          let oy = point[1] - (y + top + height / 2);\n          const dk = nk / k;\n          ox *= 1 - dk;\n          oy *= 1 - dk;\n          setStyle(wrapper, {\n            overflow: '',\n            transform: `translate(${x + deltaX + ox}px,${\n              y + deltaY + oy\n            }px) scale(${nk})`,\n            transition: 'none',\n          });\n        }\n        setStyle(this.container, {\n          background: `rgba(0,0,0,${(nk - 0.3) / 0.7})`,\n          transition: 'none',\n        });\n      }\n      return;\n    }\n    // 非内部图片操作，均是外部swiper操作\n    const swiperRange = [(1 - length) * this.getItemSize(), 0];\n    // 先把当前值反算出阻尼之前的原值\n    let bt = between(this._translate, swiperRange);\n    let t =\n      bt + revokeDamping(this._translate - bt, { max: this.getItemSize() });\n    // 再对总值进行总体阻尼计算\n    bt = between(\n      (t += this._direction === 'vertical' ? deltaY : deltaX),\n      swiperRange,\n    );\n    t = bt + performDamping(t - bt, { max: this.getItemSize() });\n    this.transitionRun(t, { duration: 0 });\n  } else {\n    const { entity } = this._image || {};\n    if (entity) {\n      if (entity.isTransitioning()) {\n        return;\n      }\n      if (oneFinger) {\n        // 实现单指move\n        entity.move(point, 0, 1, deltaX, deltaY);\n      } else {\n        // 双指move\n        entity.move(point, angle, scale, deltaX, deltaY);\n      }\n    }\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 13:56:53\n * @Description: ******\n */\n\nimport { type GEvent } from '@huangjs888/gesture';\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\nimport { setStyle } from '../dom';\n\nexport default function touchEnd(this: Gallery | SingleGallery, e: GEvent) {\n  const { toucheIds, point } = e;\n  if (toucheIds.length === 0) {\n    // 抬起最后一根手指时，重置_fgBehavior\n    this._fgBehavior = 0;\n  } else if (this._fgBehavior === 1) {\n    // 多指视作单指时，抬起非最后一根手指，不做任何操作\n    if (this instanceof Gallery) {\n      // 微信这种情况下是slide了，其实我觉得吧，可以不用，影响不大\n      if (this._moveTarget === 'outside') {\n        const size = this.getItemSize();\n        const index = size === 0 ? 0 : -this._translate / this.getItemSize();\n        this.slide(Math.round(index));\n      }\n    }\n    return;\n  }\n  // entity.reset内部会做isTransitioning的判断\n  // 曲线救国 3：这里使用_rotateAngle是不是数字来判断是否取消动画\n  const cancel =\n    !!this._gesture && typeof this._gesture._rotateAngle !== 'number';\n  if (this instanceof Gallery) {\n    // 因为下面需要用到this._moveTarget值，所以这里暂存一下值，不然提前重置了\n    const target = this._moveTarget;\n    if (toucheIds.length === 0) {\n      // 抬起最后一根手指时，重置_moveTarget\n      this._moveTarget = 'none';\n    }\n    if (this.isTransitioning()) {\n      return;\n    }\n    const { entity, wrapper } =\n      (this._images && this._images[this._activeIndex]) || {};\n    if (target === 'closures') {\n      const ele = this.container;\n      if (ele) {\n        setStyle(ele, {\n          background: 'rgba(0,0,0,1)',\n          transition: 'all 0.4s',\n        });\n        if (wrapper) {\n          setStyle(wrapper, {\n            transform: 'translate(0px,0px) scale(1)',\n            transition: 'transform 0.4s',\n          });\n        }\n        const transitionend = (ee: TransitionEvent) => {\n          if (\n            ee.target === ele &&\n            ee.propertyName.indexOf('background') !== -1\n          ) {\n            ele.removeEventListener('transitionend', transitionend);\n            setStyle(ele, {\n              transition: 'none',\n            });\n            if (wrapper) {\n              setStyle(wrapper, {\n                overflow: 'hidden',\n                transition: 'none',\n              });\n            }\n          }\n        };\n        ele.addEventListener('transitionend', transitionend);\n      }\n      return;\n    }\n    if (entity) {\n      if (entity.isTransitioning()) {\n        return;\n      }\n\n      entity.reset(point, cancel);\n    }\n    // 只有在swiper的时候才会下一张\n    const size = this.getItemSize();\n    let index = this._activeIndex;\n    if (target === 'outside') {\n      index = size === 0 ? 0 : -this._translate / this.getItemSize();\n    }\n    // Math.round代表移动超过一半，就下一张，后续可以加入阈值参数判断, slide方法里会更新_activeIndex\n    this.slide(Math.round(index));\n  } else {\n    const { entity } = this._image || {};\n    if (entity) {\n      if (entity.isTransitioning()) {\n        return;\n      }\n      // entity.reset内部会做isTransitioning的判断\n      // 曲线救国 3：这里使用_rotateAngle是不是数字来判断是否为双指\n      entity.reset(point, cancel);\n    }\n  }\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-07-28 09:57:17\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 14:26:46\n * @Description: ******\n */\n\nimport Gesture from '@huangjs888/gesture';\nimport swipe from './swipe';\nimport longTap from './longTap';\nimport singleTap from './singleTap';\nimport doubleTap from './doubleTap';\nimport touchStart from './touchStart';\nimport touchMove from './touchMove';\nimport touchEnd from './touchEnd';\nimport Gallery from '../gallery';\nimport SingleGallery from '../singleGallery';\n\nexport default function bindGesture(\n  this: Gallery | SingleGallery,\n  element: HTMLElement,\n) {\n  // 绑定手势\n  const gesture = new Gesture(element);\n  if (gesture.done()) {\n    gesture.on('touchStart', touchStart.bind(this));\n    gesture.on('touchMove', touchMove.bind(this));\n    gesture.on('doubleTap', doubleTap.bind(this));\n    gesture.on('swipe', swipe.bind(this));\n    gesture.on('longTap', longTap.bind(this));\n    gesture.on('singleTap', singleTap.bind(this));\n    gesture.on('touchEnd', touchEnd.bind(this));\n  }\n  return gesture;\n}\n","/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 17:33:24\n * @Description: ******\n */\nimport Gesture from '@huangjs888/gesture';\nimport Transition, {\n  TAProperty,\n  easeOutQuart,\n  type EaseFn,\n} from '@huangjs888/transition';\nimport loadImage, { type Image, type ImageOption } from './image';\nimport bindGesture from './events';\nimport {\n  createContainer,\n  createContent,\n  createIndicator,\n  createIndicatorItem,\n  createWrapper,\n  setStyle,\n} from './dom';\n\nclass Gallery {\n  container: HTMLElement | null = null;\n  contentEl: HTMLElement | null = null;\n  _itemGap: number = 0;\n  _direction: Direction = 'horizontal'; // 滑动方向\n  _rectSize: RectSize | null = null;\n  _events:\n    | {\n        [key in string]?: () => void | boolean;\n      }\n    | null = null;\n  _images: Image[] | null = null;\n  _activeIndex: number = -1;\n  _translate: number = 0;\n  _transition: Transition | null = null;\n  _gesture: Gesture | null = null; // 手势对象\n  _fgBehavior: number = 0; // 当第一根手指放上去后，接着有三种行为：0: 直接拿开 1: 直接移动 2: 再放一根手指\n  _moveTarget: 'closures' | 'outside' | 'inside' | 'none' = 'none'; // 判断是内部的图片移动，还是外部swiper移动，还是直接关闭\n  _removeResize: (() => void) | null = null;\n  constructor({\n    container,\n    imageUrls = [],\n    activeIndex = 0,\n    direction = 'horizontal',\n    itemGap = 20,\n    hasLoading = true,\n    hasIndicator = true,\n    isLazy = true,\n    options = {},\n    ...events\n  }: SOption) {\n    const _container = (this.container = createContainer(container));\n    const contentEl = (this.contentEl = createContent(\n      direction === 'vertical',\n      _container,\n    ));\n    const indicator = createIndicator(\n      direction === 'vertical',\n      hasIndicator && imageUrls.length > 1,\n      this.container,\n    );\n    this._images = imageUrls.map((url, index) => {\n      const image: Image = {\n        wrapper: createWrapper(\n          index === 0,\n          direction === 'vertical',\n          hasLoading,\n          itemGap,\n          contentEl,\n        ),\n        indicator: createIndicatorItem(direction === 'vertical', indicator),\n        url,\n        width: 0,\n        height: 0,\n        options,\n      };\n      if (!isLazy) {\n        // 图片如果加载过慢，show的时候图片因为没有对象，不会计算尺寸，所以这里在加载成功的时候计算一下\n        loadImage(image).then((okay) => okay && this.resetItemSize(index));\n      }\n      return image;\n    });\n    this._gesture = bindGesture.apply(this, [_container]);\n    // 创建过度\n    this._transition = new Transition({\n      element: this.contentEl,\n      propertyName: 'transform',\n      propertyValue: new (class extends TAProperty {\n        toString() {\n          return `translate${direction === 'vertical' ? 'Y' : 'X'}(${\n            this.value.translate\n          }px)`;\n        }\n      })({ translate: this._translate }),\n    });\n    this._itemGap = itemGap;\n    this._direction = direction;\n    this._events = events;\n    this.slide(activeIndex, { duration: 0 });\n    // 浏览器窗口变化重新计算容器尺寸和所有图片尺寸\n    const resize = () => {\n      this.resetSize();\n      this.resetItemSize();\n    };\n    window.addEventListener('resize', resize);\n    this._removeResize = () => {\n      window.removeEventListener('resize', resize);\n    };\n  }\n  resetSize() {\n    if (!this.container || !this.contentEl || !this._images) {\n      return;\n    }\n    // 容器宽高设置\n    const { left, top, width, height } = this.container.getBoundingClientRect();\n    this._rectSize = { left, top, width, height };\n    const length = this._images.length;\n    if (length > 0) {\n      setStyle(this.contentEl, {\n        width:\n          this._direction === 'vertical'\n            ? width\n            : width * length + (length - 1) * this._itemGap,\n        height:\n          this._direction === 'vertical'\n            ? height * length + (length - 1) * this._itemGap\n            : height,\n      });\n    }\n  }\n  resetItemSize(index?: number) {\n    if (!this._rectSize || !this._images) {\n      return;\n    }\n    const { left, top, width, height } = this._rectSize;\n    const resize = (image: Image) => {\n      if (image && image.entity && width !== 0 && height !== 0) {\n        image.entity.setSizeInfo({\n          containerCenter: [left + width / 2, top + height / 2],\n          containerWidth: width,\n          containerHeight: height,\n          naturalWidth: image.width,\n          naturalHeight: image.height,\n        });\n        const { elementHeight } = image.entity.getSizeInfo();\n        if (this._direction !== 'vertical' && elementHeight > height) {\n          setStyle(image.wrapper, {\n            alignItems: 'flex-start',\n          });\n        }\n      }\n    };\n    if (typeof index === 'number') {\n      resize(this._images[index]);\n    } else {\n      this._images.forEach(resize);\n    }\n  }\n  getItemSize() {\n    if (!this._rectSize) {\n      return 0;\n    }\n    const { width, height } = this._rectSize;\n    const wh = this._direction === 'vertical' ? height : width;\n    return wh === 0 ? 0 : wh + this._itemGap;\n  }\n  slide(\n    index: number,\n    options?: {\n      duration?: number;\n      easing?: EaseFn;\n    },\n  ) {\n    if (!this._images || this._images.length === 0) {\n      return Promise.resolve();\n    }\n    const _index = Math.max(Math.min(index, this._images.length - 1), 0);\n    const isChange = this._activeIndex !== _index;\n    if (isChange) {\n      const lastIndicator = (this._images[this._activeIndex] || {}).indicator;\n      if (lastIndicator) {\n        setStyle(lastIndicator, {\n          width: 7,\n          height: 7,\n          opacity: 0.6,\n        });\n      }\n      const thisIndicator = (this._images[_index] || {}).indicator;\n      if (thisIndicator) {\n        setStyle(thisIndicator, {\n          width: 8,\n          height: 8,\n          opacity: 1,\n        });\n      }\n      this._activeIndex = _index;\n      loadImage(this._images[_index]).then(\n        // lazy的时候，滑到这里才加载片，所以加载成功后需要计算该图片尺寸\n        (okay) => okay && this.resetItemSize(_index),\n      );\n    }\n    const _translate = -_index * this.getItemSize();\n    return this.transitionRun(_translate, options).then((v) => {\n      if (\n        isChange &&\n        this._events &&\n        typeof this._events.onChange === 'function'\n      ) {\n        this._events.onChange();\n      }\n      return v;\n    });\n  }\n  next(options?: { duration?: number; easing?: EaseFn }) {\n    return this.slide(this._activeIndex + 1, options);\n  }\n  prev(options?: { duration?: number; easing?: EaseFn }) {\n    return this.slide(this._activeIndex - 1, options);\n  }\n  transitionRun(\n    translate: number,\n    options: {\n      duration?: number;\n      easing?: EaseFn;\n      before?: EaseFn;\n    } = {},\n  ) {\n    const delta = translate - this._translate;\n    if (delta === 0 || !this._transition) {\n      return Promise.resolve({ translate: this._translate });\n    }\n    if (typeof options.duration === 'number' && options.duration <= 0) {\n      // 这里移动时不需要动画，可以直接进行绑定赋值\n      this._translate = translate;\n      this._transition.bind({ translate });\n      return Promise.resolve({ translate });\n    }\n    this._translate = translate;\n    return this._transition\n      .apply(\n        { translate: delta },\n        {\n          precision: { translate: 1 },\n          cancel: true,\n          duration: 500,\n          easing: easeOutQuart,\n          ...options,\n        },\n      )\n      .then((value) => {\n        if (!this.isTransitioning()) {\n          // 在最后一个动画的最后一帧结束重新绑定一下过渡值，目的是为了让_transition里的value和_transform保持一致\n          if (this._transition) {\n            this._transition.bind({ translate: this._translate });\n          }\n        }\n        return value;\n      });\n  }\n  transitionCancel() {\n    if (!this._transition) {\n      return 0;\n    }\n    // cancel返回值是动画未执行的部分\n    return this._transition.cancel().map((value) => {\n      // 取消动画时应该把this._transform内的值减掉还未执行的部分\n      this._translate -= value.translate;\n    }).length;\n  }\n  isTransitioning() {\n    if (!this._transition) {\n      return false;\n    }\n    return this._transition.transitioning();\n  }\n  destory() {\n    // 销毁手势事件\n    if (this._gesture) {\n      this._gesture.destory();\n      this._gesture = null;\n    }\n    if (this._removeResize) {\n      this._removeResize();\n      this._removeResize = null;\n    }\n    this._transition = null;\n    this._rectSize = null;\n    this._images = null;\n    this._events = null;\n    this.contentEl = null;\n    if (this.container && this.container.parentNode) {\n      this.container.parentNode.removeChild(this.container);\n      this.container = null;\n    }\n  }\n  open() {\n    const { container } = this;\n    if (!container || container.style.display === 'block') {\n      return;\n    }\n    setStyle(container, {\n      display: 'block',\n      opacity: 0,\n    });\n    // 设置容器宽高尺寸\n    this.resetSize();\n    // 要计算每一张图片尺寸\n    // 初始化显示的图片如果加载很快，还没open就加载完成触发了resetItemSize\n    // 由于此时container没有尺寸，图片也不会计算尺寸，那就需要在这里再次计算一下\n    this.resetItemSize();\n    // 计算完尺寸，自然要将当前activeIndex的图片展示出来，要计算一下swiper的位移\n    if (this._transition) {\n      this._translate = -this._activeIndex * this.getItemSize();\n      this._transition.bind({ translate: this._translate });\n    }\n    // resetSize会触发回流，让opacity=0已经生效，所以后续的不需要放到setTimeout里了\n    setStyle(container, {\n      opacity: 1,\n      transition: 'opacity 0.4s',\n    });\n    const transitionend = (ee: TransitionEvent) => {\n      if (ee.target === container && ee.propertyName === 'opacity') {\n        container.removeEventListener('transitionend', transitionend);\n        container.ontransitionend = null;\n        setStyle(container, {\n          transition: 'none',\n        });\n      }\n    };\n    container.addEventListener('transitionend', transitionend);\n  }\n  close() {\n    const { container } = this;\n    if (!container) {\n      return;\n    }\n    setStyle(container, {\n      opacity: 0,\n      transition: 'opacity 0.4s',\n    });\n    const transitionend = (ee: TransitionEvent) => {\n      if (ee.target === container && ee.propertyName === 'opacity') {\n        container.removeEventListener('transitionend', transitionend);\n        setStyle(container, {\n          transition: 'none',\n        });\n        this.destory();\n      }\n    };\n    container.addEventListener('transitionend', transitionend);\n  }\n}\n\ntype RectSize = {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n};\n\ntype Direction = 'vertical' | 'horizontal';\n\nexport type SOption = {\n  container?: HTMLElement | string;\n  imageUrls?: string[];\n  direction?: Direction;\n  activeIndex?: number;\n  itemGap?: number;\n  hasLoading?: boolean;\n  hasIndicator?: boolean;\n  isLazy?: boolean;\n  options?: ImageOption;\n  longTap?: () => void;\n  singleTap?: () => void;\n  downSwipe?: () => void;\n  onChange?: () => void;\n};\n\nexport default Gallery;\n","/*\n * @Author: Huangjs\n * @Date: 2022-05-11 17:49:45\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-07-31 17:33:11\n * @Description: ******\n */\nimport Gallery from './gallery';\nimport SingleGallery from './singleGallery';\nimport Entity from './entity';\nimport loadImage from './image';\n\nexport * from './gallery';\n\nexport * from './singleGallery';\n\nexport * from './entity';\n\nexport * from './image';\n\nexport { Gallery, SingleGallery, Entity, loadImage };\n\nexport default function previewImage({\n  urls,\n  current,\n  showMenu,\n  ...restOption\n}: {\n  urls: string[];\n  current?: string;\n  showMenu?: () => void;\n  direction?: 'horizontal' | 'vertical';\n  itemGap?: number;\n  hasIndicator?: boolean;\n  isLazy?: boolean;\n}) {\n  const index = !current ? 0 : urls.indexOf(current);\n  const gallery = new Gallery({\n    imageUrls: urls,\n    activeIndex: index,\n    ...restOption,\n    longTap: () => {\n      typeof showMenu === 'function' && showMenu();\n    },\n    singleTap: () => {\n      gallery.close();\n    },\n    downSwipe: () => {\n      gallery.close();\n      // 阻止downSwipe后效果回弹\n      return true;\n    },\n  });\n  gallery.open();\n}\n"],"names":["ratioOffset","v","k","t","effectuate","fn","args","isBetween","min","max","between","_","Math","_element","element","sizeInfo","dblAdjust","dblScale","damping","rotation","scalation","translation","containerCenter","containerWidth","containerHeight","naturalWidth","naturalHeight","elementWidth","elementHeight","document","querySelector","e","HTMLElement","createElement","style","opacity","innerHTML","this","_transform","Transform","a","x","y","_transition","Transition","propertyName","propertyValue","value","toString","TAProperty","toRaw","setSizeInfo","setDblAdjust","setDamping","setDblScale","setRotation","setScalation","setTranslation","_sizeInfo","width","aspectRatio","height","getRotation","getScalation","getXTranslation","getYTranslation","transitionRun","duration","_rotation","_scalation","getDblScale","xy","setXTranslation","setYTranslation","_translation","getSizeInfo","bx","by","_dblScale","aj","_dblAdjust","key","_damping","indexOf","transform","transformTo","point","transformRaw","options","getTransform","ta","tk","tx","ty","_point","_options","Array","isArray","undefined","_a","_k","_x","_y","_transformRaw","computeOffset","ox","oy","bind","Promise","resolve","deltaValue","precision","apply","cancel","easing","easeOutQuart","then","isTransitioning","map","Object","keys","forEach","val","length","transitioning","adjust","dk","cx","cy","cw","ch","ew","eh","angle","scale","deltaX","deltaY","aRange","isDamping","ba","revokeDamping","performDamping","kRange","bk","mode","xMax","yMax","getDblAdjust","stretch","transition","maxBounce","xyScale","xyPos","xyRange","getTranslation","sign","_stretch","abs","_duration","easeOutQuad","xySwipe","xyBounce","velocity","sqrt","xyMove","kt","loadingIcon","errorIcon","autoPxReg","setStyle","ele","css","replace","toLowerCase","test","String","setProperty","createWrapper","isFirst","isVertical","hasLoading","itemGap","wrapper","position","display","justifyContent","alignItems","overflow","flex","marginTop","marginLeft","loading","top","left","appendChild","loadImage2","image","entity","url","loadImage","Entity","error","color","fontSize","flexDirection","swipe","Gallery","_images","_activeIndex","_moveTarget","swipeComputed","option","translate","getItemSize","all","before","progress","s","sb","_translate","b","diff","stretchX","stretchY","_direction","xRange","swipeBounce","yRange","direction","_events","downSwipe","index","slide","ceil","floor","_image","longTap","singleTap","doubleTap","round","touchStart","toucheIds","_fgBehavior","stopCount","transitionCancel","rest","isLast","_gesture","_preventTap","_preventSingleTap","_preventDoubleTap","_firstPoint","_longTapTimer","clearTimeout","isRightDown","x0","y0","x1","y1","console","log","atan","PI","touchMove","oneFinger","_rotateAngle","movePoint","endPoint","fixedX","fixedY","rightDown","upMove","downMove","leftMove","rightMove","_deltaX","_deltaY","_delta","move","container","_rectSize","sk","moveX","moveY","nk","styles","split","xs","ys","ks","parseFloat","background","swiperRange","bt","touchEnd","target","addEventListener","transitionend","ee","removeEventListener","reset","size","bindGesture","gesture","Gesture","done","on","imageUrls","activeIndex","hasIndicator","isLazy","events","_container","zIndex","body","createContainer","contentEl","createContent","indicator","bottom","right","createIndicator","item","borderRadius","margin","okay","resetItemSize","_itemGap","resize","resetSize","window","_removeResize","getBoundingClientRect","wh","_index","isChange","lastIndicator","thisIndicator","onChange","delta","destory","parentNode","removeChild","ontransitionend","previewImage","urls","current","showMenu","restOption","gallery","close","open"],"sourceRoot":""}